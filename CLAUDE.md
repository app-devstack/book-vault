# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

Book-Vault is a React Native/Expo mobile app for managing books purchased from various online stores. The app organizes books by series and tracks purchase information with a local SQLite database.

## Development Commands

### Core Development
- `bun start` - Start Expo development server
- `bun run android` - Run on Android device/emulator  
- `bun run ios` - Run on iOS device/simulator
- `bun run web` - Run web version
- `bun run lint` - Run ESLint
- `bun run typecheck` - Run TypeScript type checking

### Database Management  
- `bun run db:generate` - Generate Drizzle migration files
- `bun run db:generate:custom` - Generate custom migration files
- `bun run db:reset` - Drop all database tables (reset database)

### Build & Deploy
- `bun run deploy` - Build for Android development profile
- `bun run preview` - Build Android preview
- `bun run preview:nocache` - Build preview with cleared cache

## Architecture

### Tech Stack
- **React Native 0.79.3** with **React 19.0.0**
- **Expo ~53.0.9** with Expo Router for file-based routing
- **TypeScript ~5.8.3** for type safety
- **SQLite** (expo-sqlite) with **Drizzle ORM 0.43.1** 
- **TanStack React Query 5.77.2** for API state management
- **Google Books API** integration for book metadata

### Database Schema
Three main entities with relational structure:
- **Series**: Groups books by series title, author, description
- **Books**: Individual book records with metadata, purchase info, store links
- **Shops**: Store information (name, URL, logo)

### State Management
- **Context API** with custom `createConstate` utility (see `src/components/providers/utils/constate.tsx`)
- **BooksProvider** manages all book/series state and CRUD operations
- **React Query** for Google Books API calls

### Key Directories
- `src/app/` - Expo Router pages with file-based routing
- `src/features/` - Feature modules (home, register, series, settings)  
- `src/components/providers/` - Context providers
- `src/db/` - Database schema and types
- `src/utils/service/` - Service layer (book-service, series-service)
- `src/hooks/` - Custom React hooks

## Important Patterns

### Provider Usage
Always use the `createConstate` utility for new providers instead of manual Context API setup. See `BooksProvider.tsx` as reference.

### Database Operations
- Use Drizzle ORM services in `src/utils/service/` 
- All database operations should go through service layer, not direct ORM calls
- UUID v7 is used for primary keys

### Error Handling
Functions should throw errors to allow upper layers to handle them appropriately. See `useBooks.ts` for error handling patterns.

### TypeScript
- Strict typing is enforced
- Use `satisfies` operator for type assertions where appropriate
- Database types are auto-generated by Drizzle

## External Integrations

### Google Books API
Located in `src/utils/googleBooks/`. Handles book search, metadata extraction, and image URL processing. Always validate and convert HTTP image URLs to HTTPS.

## UI Language
The application UI is in Japanese, targeting Japanese users. Maintain this language consistency in user-facing text.

## Current Development
The app is actively developed with feature branches (currently on `BV-4-delete-register-book`). Recent work focuses on series management and book registration features.