# TanStack Query æ–°å®Ÿè£…è¨ˆç”»

## ðŸŽ¯ å„ªå…ˆåº¦åˆ¥ã‚¿ã‚¹ã‚¯ãƒªã‚¹ãƒˆ

### **é«˜å„ªå…ˆåº¦ (å³åº§ã«å¯¾å¿œãŒå¿…è¦)**

1. SQLiteã‚µãƒ¼ãƒ“ã‚¹é–¢æ•°ã‚’TanStack Queryã®ã‚¯ã‚¨ãƒªé–¢æ•°ã¨ã—ã¦ä½¿ç”¨ã§ãã‚‹ã‚ˆã†éžåŒæœŸå‡¦ç†ã‚’é©åˆ‡ã«å®Ÿè£…
2. useBooks()ãƒ•ãƒƒã‚¯ä½œæˆ - å…¨æ›¸ç±å–å¾—ç”¨ã®ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯
3. useBook(id)ãƒ•ãƒƒã‚¯ä½œæˆ - ç‰¹å®šæ›¸ç±å–å¾—ç”¨ã®ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯

### **ä¸­å„ªå…ˆåº¦ (é †æ¬¡å¯¾å¿œ)**

4. useSeriesBooks()ãƒ•ãƒƒã‚¯ä½œæˆ - ã‚·ãƒªãƒ¼ã‚ºåˆ¥æ›¸ç±å–å¾—ç”¨ã®ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯
5. æ—¢å­˜ã®BooksProviderã¨TanStack Queryã®ä½µç”¨æ–¹æ³•ã‚’æ¤œè¨Žãƒ»çµ±åˆ
6. ãƒ›ãƒ¼ãƒ ç”»é¢ã§useBooks()ãƒ•ãƒƒã‚¯ã‚’ä½¿ç”¨ã—ã¦ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒ»ã‚¨ãƒ© ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’å®Ÿè£…
7. æ›¸ç±è©³ç´°ç”»é¢ã§useBook(id)ãƒ•ãƒƒã‚¯ã‚’ä½¿ç”¨ã™ã‚‹å®Ÿè£…ã«å¤‰æ›´

### **ä½Žå„ªå…ˆåº¦ (å¾Œå›žã—å¯èƒ½)**

8. ã‚·ãƒªãƒ¼ã‚ºç”»é¢ã§useSeriesBooks()ãƒ•ãƒƒã‚¯ã‚’ä½¿ç”¨ã™ã‚‹å®Ÿè£…ã«å¤‰æ›´
9. **useRefreshBooks()ãƒ•ãƒƒã‚¯ä½œæˆ** - æ‰‹å‹•ãƒ‡ãƒ¼ã‚¿å†å–å¾—æ©Ÿèƒ½ï¼ˆSWRã®triggerç›¸å½“ï¼‰
10. **å„ç”»é¢ã«refetch/invalidateãƒœã‚¿ãƒ³è¿½åŠ ** - ãƒ—ãƒ«ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ä»¥å¤–ã®æ‰‹å‹•æ›´æ–°æ‰‹æ®µã®æä¾›

## ðŸ“‹ å®Ÿè£…ã®æ–¹å‘æ€§

ç¾åœ¨ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯æ—¢å­˜ã®BooksProviderã§Context APIã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ãŒã€TanStack Queryã‚’å°Žå…¥ã—ã¦ã‚µãƒ¼ãƒãƒ¼çŠ¶æ…‹ç®¡ç†ã‚’æ”¹å–„ã™ã‚‹æ–¹é‡ã§ã™ã€‚æ—¢å­˜ã®ã‚µãƒ¼ãƒ“ã‚¹å±¤ï¼ˆbookServiceã€seriesServiceï¼‰ã‚’æ´»ç”¨ã—ãªãŒã‚‰ã€æ®µéšŽçš„ã«TanStack Queryãƒ™ãƒ¼ã‚¹ã®å®Ÿè£…ã«ç§»è¡Œã—ã¦ã„ãã¾ã™ã€‚

## ðŸ”§ æŠ€è¡“çš„ãªè€ƒæ…®äº‹é …

### æ—¢å­˜ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¨ã®çµ±åˆ

- BooksProviderã®çŠ¶æ…‹ç®¡ç†ã¨TanStack Queryã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½ã®ä½µç”¨æ–¹æ³•
- SQLiteã‚µãƒ¼ãƒ“ã‚¹å±¤ã®éžåŒæœŸå‡¦ç†å¯¾å¿œ
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®çµ±ä¸€åŒ–

### å®Ÿè£…é †åºã®ç†ç”±

1. **åŸºç›¤æ•´å‚™**: ã‚µãƒ¼ãƒ“ã‚¹é–¢æ•°ã®éžåŒæœŸå¯¾å¿œãŒå…¨ã¦ã®åŸºç¤Žã¨ãªã‚‹
2. **ã‚³ã‚¢ãƒ•ãƒƒã‚¯**: useBooks/useBookãŒæœ€ã‚‚ä½¿ç”¨é »åº¦ãŒé«˜ã„
3. **ç”»é¢çµ±åˆ**: æ—¢å­˜ç”»é¢ã¸ã®æ®µéšŽçš„é©ç”¨ã§å®‰å…¨ãªç§»è¡Œã‚’å®Ÿç¾

## ðŸ“š å‚è€ƒå®Ÿè£…ä¾‹ï¼ˆtodos.mdã‚ˆã‚Šï¼‰

```tsx
// ç›®æ¨™ã¨ã™ã‚‹å®Ÿè£…å½¢å¼
export const useBooks = () => {
  return useQuery({
    queryKey: ['books'],
    queryFn: bookService.getAllBooks,
  })
}

export const useBook = (id: string) => {
  return useQuery({
    queryKey: ['books', id],
    queryFn: () => bookService.getBookById(id),
    enabled: !!id,
  })
}

// ãƒ‡ãƒ¼ã‚¿å†å–å¾—æ©Ÿèƒ½
export const useRefreshBooks = () => {
  const queryClient = useQueryClient()
  return () => queryClient.invalidateQueries({ queryKey: ['books'] })
}
